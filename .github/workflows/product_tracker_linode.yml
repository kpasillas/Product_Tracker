name: Run Product Tracker (Linode)

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Create Linode
        run: |
          curl -X POST https://api.linode.com/v4/linode/instances \
            -H "Authorization: Bearer $LINODE_TOKEN" \
            -H "Content-Type: application/json" \
            -d '{
              "label": "product-tracker-run",
              "region": "us-lax",
              "type": "g6-nanode-1",
              "image": "linode/ubuntu22.04",
              "root_pass": "TEMP_PASSWORD",
              "authorized_keys": [],
              "user_data": "'"$(base64 -w0 .github/workflows/cloud-init.yaml)"'"
            }'
        env:
          LINODE_TOKEN: ${{ secrets.LINODE_TOKEN }}
